---
import Layout from '../layouts/Layout.astro';

const properties = [];

async function fetchProperties(location) {
  const response = await fetch(`/api/properties.json?location=${encodeURIComponent(location)}`);
  const data = await response.json();
  properties.length = 0; // Clear the array
  properties.push(...data); // Push new data
  return properties;
}
---

<Layout>
  <section class="search-section py-8 px-4">
    <form id="search-form" class="search-form flex justify-center gap-4 mb-8">
      <input 
        type="text" 
        id="location-input" 
        placeholder="Enter location" 
        required 
        class="px-4 py-2 border rounded w-1/3" 
      />
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Search</button>
    </form>

    <div id="property-list" class="property-list grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {properties.length > 0 ? properties.map(property => (
        <div key={property.id} class="property-item bg-white dark:bg-gray-800 p-4 rounded shadow">
          <h3 class="text-lg font-bold mb-2">{property.location}</h3>
          <p class="mb-2">{property.description}</p>
          <p class="font-bold text-xl">${property.price.toLocaleString()}</p>
        </div>
      )) : (
        <p class="text-center text-gray-600 dark:text-gray-400">No properties found.</p>
      )}
    </div>
  </section>

  <script>
    document.getElementById('search-form').addEventListener('submit', async (event) => {
      event.preventDefault();
      const location = document.getElementById('location-input').value;
      await fetchProperties(location);
      document.getElementById('property-list').innerHTML = properties.map(property => `
        <div class="property-item bg-white dark:bg-gray-800 p-4 rounded shadow">
          <h3 class="text-lg font-bold mb-2">${property.location}</h3>
          <p class="mb-2">${property.description}</p>
          <p class="font-bold text-xl">$${property.price.toLocaleString()}</p>
        </div>
      `).join('');
    });
  </script>
</Layout>
